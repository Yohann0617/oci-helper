import{U as v,V as W,W as K,X as G,Y as X,Z as P,c as h,b as g,w as k,r as w,o as p,a as o,F as Z,h as O,m as Y,t as M,_ as ee,v as S,p as te,k as ne,$ as z,a0 as F}from"./chunk-vendors.CdTauPKY.js";import{_ as oe}from"./index.C40PP_gZ.js";const se={class:"chat-wrapper"},le={class:"header-content"},ae={class:"header-left"},ie=["disabled"],re={class:"model-selector"},ce={class:"model-option"},de={class:"model-name"},ue={class:"model-desc"},pe={class:"bubble"},ve={key:0},he={key:1,class:"ai-content"},me={key:0,class:"loading-text"},fe=["innerHTML"],ge={class:"input-wrapper"},we={class:"input-actions"},_e=["disabled","title"],be={key:0,class:"loading-spinner"},ke={key:1,class:"send-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ye={key:0,class:"processing-hint"},Me={class:"current-model-hint"},xe={class:"current-model-text"},He={class:"session-id-text"},Be={__name:"AiChat",setup(Te){const _=v(""),T=v(""),u=v([]),C=v(null),x=v(!1),H=v(!1),D=v(null);let a=null;const b=v(Q()),y=v("deepseek-ai/DeepSeek-R1-0528-Qwen3-8B"),I=v([{value:"deepseek-ai/DeepSeek-R1-Distill-Qwen-7B",label:"deepseek-ai/DeepSeek-R1-Distill-Qwen-7B-128K-Math",description:"deepseek-ai"},{value:"deepseek-ai/DeepSeek-R1-0528-Qwen3-8B",label:"deepseek-ai/DeepSeek-R1-0528-Qwen3-8B-128K",description:"deepseek-ai"},{value:"Qwen/Qwen2-7B-Instruct",label:"Qwen/Qwen2-7B-Instruct-32K",description:"Qwen"},{value:"Qwen/Qwen2.5-7B-Instruct",label:"Qwen/Qwen2.5-7B-Instruct-32K",description:"Qwen"},{value:"Qwen/Qwen2.5-Coder-7B-Instruct",label:"Qwen/Qwen2.5-Coder-7B-Instruct-32K",description:"Qwen"},{value:"Qwen/Qwen3-8B",label:"Qwen/Qwen3-8B",description:"Qwen"},{value:"THUDM/GLM-4-9B-0414",label:"THUDM/GLM-4-9B-0414-32K",description:"THUDM"},{value:"THUDM/GLM-4.1V-9B-Thinking",label:"THUDM/GLM-4.1V-9B-Thinking-64K",description:"THUDM"},{value:"THUDM/glm-4-9b-chat",label:"THUDM/glm-4-9b-chat-128k",description:"THUDM"},{value:"THUDM/GLM-Z1-9B-0414",label:"THUDM/GLM-Z1-9B-0414-128k",description:"THUDM"},{value:"tencent/Hunyuan-MT-7B",label:"tencent/Hunyuan-MT-7Bï¼ˆé™å…ï¼‰",description:"tencent"},{value:"internlm/internlm2_5-7b-chat",label:"internlm/internlm2_5-7b-chat-32K-å¯¹è¯",description:"netease-youdao"}]),c=W(()=>x.value||H.value);function Q(){const t=Date.now().toString(36),e=Math.random().toString(36).substring(2,8);return`chat_${t}_${e}`}const U=async()=>{try{const t=await fetch(`${T.value}/removeCache?sessionId=${b.value}`,{method:"GET"});if(t.ok){const e=await t.json();console.log("ä¼šè¯ç¼“å­˜æ¸…é™¤æˆåŠŸ:",e.message||"ä¼šè¯å†…å®¹å·²æ¸…é™¤")}else console.warn("æ¸…é™¤ä¼šè¯ç¼“å­˜å¤±è´¥:",t.statusText)}catch(t){console.error("æ¸…é™¤ä¼šè¯ç¼“å­˜æ—¶å‡ºé”™:",t)}},N=async()=>{u.value.length===0||c.value||(a&&(a.close(),a=null),await U(),u.value=[],b.value=Q(),console.log("èŠå¤©è®°å½•å·²æ¸…ç©ºï¼Œæ–°ä¼šè¯ID:",b.value))},A=()=>{const t=I.value.find(e=>e.value===y.value);return t?t.label:y.value},j=t=>{console.log("æ¨¡å‹å·²åˆ‡æ¢åˆ°:",t);const e=A();u.value.push({role:"system",content:`å·²åˆ‡æ¢åˆ°æ¨¡å‹: ${e}`,html:`<em style="color: rgba(79,76,76,0.93);">å·²åˆ‡æ¢åˆ°æ¨¡å‹: ${e}</em>`})};K.setOptions({highlight:(t,e)=>{const n=G.getLanguage(e)?e:"plaintext";return G.highlight(t,{language:n}).value},breaks:!0,gfm:!0}),window.copyCodeFromBlock=async(t,e)=>{try{const n=window.codeBlocks[e];if(!n){console.error("æ‰¾ä¸åˆ°ä»£ç å†…å®¹");return}await navigator.clipboard.writeText(n);const i=t.innerHTML;t.innerHTML=`
      <svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16">
        <path fill="currentColor" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.76L18.88,4.88L21.71,7.71L9,20.42Z"/>
      </svg>
      å·²å¤åˆ¶
    `,t.classList.add("copied"),setTimeout(()=>{t.innerHTML=i,t.classList.remove("copied")},2e3)}catch(n){console.error("å¤åˆ¶å¤±è´¥:",n);const i=window.codeBlocks[e];if(!i)return;const s=document.createElement("textarea");s.value=i,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy"),t.textContent="å·²å¤åˆ¶!",setTimeout(()=>{t.innerHTML=`
          <svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
          </svg>
          å¤åˆ¶
        `},2e3)}catch(d){console.error("é™çº§å¤åˆ¶ä¹Ÿå¤±è´¥:",d)}document.body.removeChild(s)}};const q=t=>{if(c.value){t.preventDefault();return}t.shiftKey||(t.preventDefault(),E())},V=async(t=!0)=>{var i,s;await F();const e=((i=C.value)==null?void 0:i.$el)||C.value;if(!e)return;const n=e.querySelector(".msg:last-child");if(n!=null&&n.scrollIntoView){n.scrollIntoView({behavior:t?"smooth":"auto",block:"end"});return}(s=e.scrollTo)==null||s.call(e,{top:e.scrollHeight,behavior:t?"smooth":"auto"})},$=t=>{try{if(t==null)return"";let e;typeof t=="string"?e=t:typeof t=="object"?e=JSON.stringify(t,null,2):e=String(t),typeof e!="string"&&(e=String(e));let n=K(e);return n=n.replace(/<pre><code class="language-(\w+)">([\s\S]*?)<\/code><\/pre>/g,(i,s,d)=>{const m=d.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#x27;/g,"'"),f=Date.now()+Math.random();return window.codeBlocks=window.codeBlocks||{},window.codeBlocks[f]=m,`
        <div class="code-block-wrapper">
          <div class="code-header">
            <span class="code-lang">${s||"text"}</span>
            <button class="copy-btn" onclick="copyCodeFromBlock(this, '${f}')">
              <svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
              </svg>
              å¤åˆ¶
            </button>
          </div>
          <pre><code class="language-${s}">${d}</code></pre>
        </div>
      `}),n}catch(e){return console.error("Marked å¤„ç†é”™è¯¯:",e,"è¾“å…¥å€¼:",t),String(t||"").replace(/\n/g,"<br>")}},L=v(!1),E=async()=>{if(!_.value||c.value)return;x.value=!0,H.value=!0;const t={role:"user",content:_.value},e=z({role:"ai",content:"æ€è€ƒä¸­...",isThinking:!0});u.value.push(t),await V(),u.value.push(e),await V();const n=z({role:"ai",text:"",html:""});let i="",s=!0;a&&(a.close(),a=null);try{const d=`/chat/stream?message=${encodeURIComponent(_.value)}&model=${encodeURIComponent(y.value)}&sessionId=${encodeURIComponent(b.value)}&enableInternet=${L.value}`,m=new EventSource(T.value+d);a=m,m.onmessage=async f=>{try{if(!f.data)return;let r=f.data;if(typeof r=="string"&&r.startsWith("data: ")&&(r=r.substring(6)),!r||!r.trim())return;if(r=String(r),i+=r,s){H.value=!1;const B=u.value.indexOf(e);B!==-1&&u.value.splice(B,1),u.value.push(n),s=!1}n.text=i,n.html=$(i),await V()}catch(r){console.error("å¤„ç†æ¶ˆæ¯æ—¶å‡ºé”™:",r)}},m.onerror=f=>{console.error("SSE è¿æ¥é”™è¯¯:",f),m.close(),a=null,x.value=!1,H.value=!1,s?u.value.indexOf(e)!==-1&&(e.content="è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€",e.isThinking=!1):n.html=$(n.text)},m.onopen=()=>{console.log("SSE è¿æ¥å·²å»ºç«‹")}}catch(d){console.error("å»ºç«‹ SSE è¿æ¥æ—¶å‡ºé”™:",d),x.value=!1,H.value=!1,u.value.indexOf(e)!==-1&&(e.content="æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨",e.isThinking=!1)}_.value="",await F(()=>{var d;return(d=D.value)==null?void 0:d.focus()}),x.value=!1},R=async()=>{a&&(a.close(),a=null);try{const t=`${T.value}/removeCache?sessionId=${b.value}`;if(navigator.sendBeacon)navigator.sendBeacon(t);else{const e=new XMLHttpRequest;e.open("GET",t,!1),e.send()}}catch(t){console.error("é¡µé¢å¸è½½æ—¶æ¸…é™¤ä¼šè¯ç¼“å­˜å¤±è´¥:",t)}};return X(()=>{console.log("èŠå¤©ç»„ä»¶å·²åˆå§‹åŒ–"),console.log("é»˜è®¤æ¨¡å‹:",y.value),console.log("ä¼šè¯ID:",b.value),window.addEventListener("beforeunload",R),document.addEventListener("visibilitychange",()=>{})}),P(()=>{window.removeEventListener("beforeunload",R),a&&(a.close(),a=null),U(),console.log("èŠå¤©ç»„ä»¶å·²å¸è½½ï¼Œä¼šè¯ç¼“å­˜å·²æ¸…é™¤")}),(t,e)=>{const n=w("el-option"),i=w("el-select"),s=w("el-header"),d=w("el-main"),m=w("el-input"),f=w("el-checkbox"),r=w("el-footer"),B=w("el-container");return p(),h("div",se,[g(B,{class:"chat-container"},{default:k(()=>[g(s,{class:"chat-header"},{default:k(()=>[o("div",le,[o("div",ae,[o("button",{class:"clear-btn",onClick:N,disabled:c.value||u.value.length===0,title:"æ¸…ç©ºèŠå¤©è®°å½•"},e[3]||(e[3]=[o("svg",{class:"clear-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[o("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1)]),8,ie)]),e[4]||(e[4]=o("div",{class:"header-center"},[o("div",{class:"robot-icon"},"ğŸ¤–"),o("span",{class:"header-title"},"oci-helper-AI Chat")],-1)),o("div",re,[g(i,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=l=>y.value=l),placeholder:"é€‰æ‹©æ¨¡å‹",size:"small",class:"model-select",disabled:c.value,onChange:j},{default:k(()=>[(p(!0),h(Z,null,O(I.value,l=>(p(),Y(n,{key:l.value,label:l.label,value:l.value},{default:k(()=>[o("span",ce,[o("span",de,M(l.label),1),o("span",ue,M(l.description),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])])]),_:1}),g(d,{class:"chat-main",ref_key:"chatMain",ref:C},{default:k(()=>[g(ee,{name:"fade",tag:"div"},{default:k(()=>[(p(!0),h(Z,null,O(u.value,(l,J)=>(p(),h("div",{key:J,class:S(["msg",l.role])},[o("div",pe,[l.role==="user"?(p(),h("div",ve,M(l.content),1)):(p(),h("div",he,[l.isThinking?(p(),h("div",me,M(l.content),1)):(p(),h("div",{key:1,class:"markdown-content",innerHTML:l.html},null,8,fe))]))])],2))),128))]),_:1})]),_:1},512),g(r,{class:"chat-input"},{default:k(()=>[o("div",ge,[o("div",{class:S(["input-container",{disabled:c.value}])},[g(m,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value=l),type:"textarea",placeholder:"é—®é—® oci-helper-AI (Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ)",autosize:{minRows:1,maxRows:4},disabled:c.value,class:"chat-textarea",onKeydown:ne(q,["enter"]),ref_key:"inputRef",ref:D},null,8,["modelValue","disabled"]),o("div",we,[o("button",{disabled:c.value||!_.value.trim(),onClick:E,class:S(["send-button",{loading:c.value}]),title:c.value?"æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...":"å‘é€æ¶ˆæ¯"},[c.value?(p(),h("div",be)):(p(),h("svg",ke,e[5]||(e[5]=[o("path",{d:"M7 11L12 6L17 11M12 18V7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",transform:"rotate(90 12 12)"},null,-1)])))],10,_e)])],2),c.value?(p(),h("div",ye,e[6]||(e[6]=[o("span",{class:"processing-text"},"AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨å€™...",-1)]))):te("",!0),o("div",Me,[g(f,{modelValue:L.value,"onUpdate:modelValue":e[2]||(e[2]=l=>L.value=l),disabled:c.value,label:"å¯ç”¨è”ç½‘æŸ¥è¯¢ï¼ˆbetaï¼‰",size:"small"},null,8,["modelValue","disabled"]),o("span",xe,"å½“å‰æ¨¡å‹: "+M(A()),1),o("span",He,"ä¼šè¯ID: "+M(b.value.slice(-8)),1)])])]),_:1})]),_:1})])}}},Le=oe(Be,[["__scopeId","data-v-f8a33a47"]]);export{Le as default};
